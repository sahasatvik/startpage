<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Startpage</title>
    
    <link rel="stylesheet" href="https://sahasatvik.github.io/cards.css">
    <link rel="stylesheet" href="styles.css">
    <link href="favicon.png" rel="shortcut icon" type="image/x-icon" />
</head>
<body>
    <div id="search">
        <input id="search-field" type="text" name="search-field" onkeypress="return search(event)"/>
    </div>
    <div id="global-container">
        <div id="logo-container">
            <img id="logo" src="https://sahasatvik.github.io/logo_alpha.svg" alt="" onmouseup="toggleTheme()"/>
            <div id="startpage">Startpage</div>
        </div>
        <div id="bookmark-card-container" class="card-container">
            <div id="github" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://github.com/sahasatvik" target="_blank">github</a>
                </div>
            </div>
            <div id="lichess" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://lichess.org" target="_blank">lichess</a>
                </div>
            </div>
            <div id="reddit" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://reddit.com" target="_blank">reddit</a>
                </div>
            </div>
            <div id="youtube" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://youtube.com" target="_blank">youtube</a>
                </div>
            </div>
        </div>
        <a id="help" href="https://github.com/sahasatvik/startpage#startpage" target="_blank">help</a>
    </div>

    <script>
        // Define trigger key codes [/ ? : ; g r w y]
        var triggers = [191, 59, 186, 71, 82, 87, 89];
        
        // Define search patterns
        var searchPatterns = [
            { pattern:  /^\?/i,
              link:     (val) => 'https://github.com/sahasatvik/startpage#commands'},
            { pattern:  /^:/i,
              link:     (val) => 'http://' + val.substring(1)},
            { pattern:  /^;/i,
              link:     (val) => 'https://' + val.substring(1)},
            { pattern:  /^r\/.+/i,
              link:     (val) => 'https://reddit.com/' + val},
            { pattern:  /^r(\/)?$/i,
              link:     (val) => 'https://reddit.com'},
            { pattern:  /^y\/s$/i,
              link:     (val) => 'https://youtube.com/feed/subscriptions'},
            { pattern:  /^y\/.+/i,
              link:     (val) => 'https://youtube.com/results?search_query=' + val.substring(2)},
            { pattern:  /^y(\/)?$/i,
              link:     (val) => 'https://youtube.com'},
            { pattern:  /^w\/.+/i,
              link:     (val) => 'https://wikipedia.org/wiki/' + val.substring(2)},
            { pattern:  /^w(\/)?$/i,
              link:     (val) => 'https://wikipedia.org'},
            { pattern:  /^g\/acc(ount)?$/i,
              link:     (val) => 'https://myaccount.google.com'},
            { pattern:  /^g\/c(al(endar)?)?$/i,
              link:     (val) => 'https://calendar.google.com'},
            { pattern:  /^g\/c(on(tact(s)?)?)?$/i,
              link:     (val) => 'https://contacts.google.com'},
            { pattern:  /^g\/d(rive)?$/i,
              link:     (val) => 'https://drive.google.com'},
            { pattern:  /^g\/k(eep)?$/i,
              link:     (val) => 'https://keep.google.com'},
            { pattern:  /^g\/n(ews)?$/i,
              link:     (val) => 'https://news.google.com'},
            { pattern:  /^g\/(about)?me$/i,
              link:     (val) => 'https://aboutme.google.com'},
            { pattern:  /^g\/m(ail)?$/i,
              link:     (val) => 'https://mail.google.com'},
            { pattern:  /^g\/m(ap(s)?)?$/i,
              link:     (val) => 'https://maps.google.com'},
            { pattern:  /^g\/m(us(ic)?)?$/i,
              link:     (val) => 'https://music.google.com'},
            { pattern:  /^g\/p(ho(to(s)?)?)?$/i,
              link:     (val) => 'https://photos.google.com'},
            { pattern:  /^g\/t(ra(nslate)?)?$/i,
              link:     (val) => 'https://translate.google.com'},
            { pattern:  /^g\/.+/i,
              link:     (val) => 'https://google.com/search?q=' + val.substring(2)},
            { pattern:  /^g(\/)?$/i,
              link:     (val) => 'https://google.com'},
            { pattern:  /^\/.+/i,
              link:     (val) => 'https://google.com/search?q=' + val.substring(1)},
            { pattern:  /^\/$/i,
              link:     (val) => 'https://google.com'},
            { pattern:  /^.+/i,
              link:     (val) => 'https://google.com/search?q=' + val}
        ];
        // Search on enter key event
        function search(e) {
            if (e.keyCode == 13) {
                var val = document.getElementById("search-field").value.trim();
                for (var i in searchPatterns) {
                    if (searchPatterns[i].pattern.test(val)) {
                        window.open(searchPatterns[i].link(val));
                        closeSearch();
                        break;
                    }
                }
            }
        }
        
        function openSearch() {
            document.getElementById('search').style.display = 'flex';
            document.getElementById('search-field').focus();
        }

        function closeSearch() {
            document.getElementById('search-field').value = '';
            document.getElementById('search-field').blur();
            document.getElementById('search').style.display = 'none';
        }

        document.addEventListener("keydown", event => {
            let code = event.keyCode;
            if (triggers.includes(code)) {
                openSearch();
            } else if (code == 27) {                        // Esc to close search
                closeSearch();
            }
        });
        
        var x = document.getElementsByClassName("card");
        var light;
        
        try {
            light = JSON.parse(localStorage.getItem("light"));
            if (light == null) {light = false;}
        } catch (err) {
            light = false;
        }
        
        function lightTheme() {
            document.getElementById("logo").classList.add("inverted");
            for (var i = 0; i < x.length; i++) {
                x[i].classList.remove("card-dark");
            }
            document.body.style.backgroundColor = "#f2f2f2";
            document.getElementById("startpage").style.color = "#1d1f21";
            document.getElementById("search").style.backgroundColor = "#f2f2f2";
            document.getElementById("search-field").style.backgroundColor = "#f2f2f2";
            document.getElementById("search-field").style.color = "#1d1f21";
        }
        function darkTheme() {
            document.getElementById("logo").classList.remove("inverted");
            for (var i = 0; i < x.length; i++) {
                x[i].classList.add("card-dark");
            }
            document.body.style.backgroundColor = "#1d1f21";
            document.getElementById("startpage").style.color = "#ffffff";
            document.getElementById("search").style.backgroundColor = "#1d1f21";
            document.getElementById("search-field").style.backgroundColor = "#1d1f21";
            document.getElementById("search-field").style.color = "#ffffff";
        }
        function toggleTheme() {
            light = !light;
            refreshTheme();
        }
        function refreshTheme() {
            theme = light? lightTheme : darkTheme;
            theme();
            try {
                localStorage.setItem("light", JSON.stringify(light));
            } catch (err) {}
        }
        refreshTheme();
    </script>
</body>
</html>
