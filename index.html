<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Startpage</title>

    <link rel="stylesheet" href="https://sahasatvik.github.io/cards.css">
    <link rel="stylesheet" href="styles.css">
    <link href="favicon.png" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="dark-theme">
    <div id="search">
        <input id="search-field" type="text" name="search-field" onkeypress="return search(event)"/>
    </div>
    <div id="global-container">
        <div id="logo-container">
            <img id="logo" src="https://sahasatvik.github.io/logo_alpha.svg" alt="" onmouseup="toggleTheme()"/>
            <div id="startpage">Startpage</div>
        </div>
        <div id="bookmark-card-container" class="card-container">
            <div id="work" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://github.com/sahasatvik" target="_blank">github</a>
                    <a class="card-item" href="https://drive.google.com" target="_blank">drive</a>
                    <a class="card-item" href="https://mail.google.com" target="_blank">mail</a>
                </div>
            </div>
            <div id="games" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://lichess.org" target="_blank">lichess</a>
                    <a class="card-item" href="https://chess.com/live" target="_blank">chess.com</a>
                    <a class="card-item" href="https://www.keybr.com" target="_blank">keybr</a>
                </div>
            </div>
            <div id="reading" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://reddit.com" target="_blank">reddit</a>
                    <a class="card-item" href="https://terrytao.wordpress.com" target="_blank">tao</a>
                    <a class="card-item" href="https://xkcd.com" target="_blank">xkcd</a>
                </div>
            </div>
            <div id="media" class="card card-dark borderless">
                <div class="card-inner-container">
                    <a class="card-item" href="https://youtube.com" target="_blank">youtube</a>
                    <a class="card-item" href="https://open.spotify.com" target="_blank">spotify</a>
                    <a class="card-item" href="https://www.last.fm/user/sahasatvik" target="_blank">lastfm</a>
                </div>
            </div>
        </div>
        <a id="help" href="https://github.com/sahasatvik/startpage#startpage" target="_blank">help</a>
    </div>

    <script>
        var hour = new Date().getHours();
        var greeting = "";
        if (hour < 6) {
            greeting = "Good night!";
        } else if (hour < 12) {
            greeting = "Good morning!";
        } else if (hour < 16) {
            greeting = "Good afternoon!";
        } else if (hour < 22) {
            greeting = "Good evening!";
        } else {
            greeting = "Good night!";
        }

        var greeters = [
            "Greetings!",
            "Hello there!",
            "What's new?",
            "Howdy!",
            "Ahoy!",
            "Aloha!",
            "Hola!",
            "Bonjour!"
        ]

        if (Math.random() < 0.2) {
            greeting = greeters[Math.floor(Math.random() * greeters.length)];
        }

        document.getElementById("startpage").innerHTML = greeting;

        // Define trigger key codes [/ ? : ; g r w y]
        var triggers = [191, 59, 186, 71, 82, 87, 89];

        // Define search patterns
        var searchPatterns = [
            { pattern:  /^\?/i,
              link:     (val) => 'https://github.com/sahasatvik/startpage#commands'},
            { pattern:  /^:/i,
              link:     (val) => 'http://' + val.substring(1)},
            { pattern:  /^;/i,
              link:     (val) => 'https://' + val.substring(1)},
            { pattern:  /^r\/.+/i,
              link:     (val) => 'https://reddit.com/' + val},
            { pattern:  /^r(\/)?$/i,
              link:     (val) => 'https://reddit.com'},
            { pattern:  /^y\/s$/i,
              link:     (val) => 'https://youtube.com/feed/subscriptions'},
            { pattern:  /^y\/m(us(ic)?)?$/i,
              link:     (val) => 'https://music.youtube.com'},
            { pattern:  /^y\/.+/i,
              link:     (val) => 'https://youtube.com/results?search_query=' + val.substring(2)},
            { pattern:  /^y(\/)?$/i,
              link:     (val) => 'https://youtube.com'},
            { pattern:  /^w\/.+/i,
              link:     (val) => 'https://wikipedia.org/wiki/' + val.substring(2)},
            { pattern:  /^w(\/)?$/i,
              link:     (val) => 'https://wikipedia.org'},
            { pattern:  /^g\/acc(ount)?$/i,
              link:     (val) => 'https://myaccount.google.com'},
            { pattern:  /^g\/c(al(endar)?)?$/i,
              link:     (val) => 'https://calendar.google.com'},
            { pattern:  /^g\/c(on(tact(s)?)?)?$/i,
              link:     (val) => 'https://contacts.google.com'},
            { pattern:  /^g\/d(rive)?$/i,
              link:     (val) => 'https://drive.google.com'},
            { pattern:  /^g\/k(eep)?$/i,
              link:     (val) => 'https://keep.google.com'},
            { pattern:  /^g\/n(ews)?$/i,
              link:     (val) => 'https://news.google.com'},
            { pattern:  /^g\/(about)?me$/i,
              link:     (val) => 'https://aboutme.google.com'},
            { pattern:  /^g\/m(ail)?$/i,
              link:     (val) => 'https://mail.google.com'},
            { pattern:  /^g\/m(ap(s)?)?$/i,
              link:     (val) => 'https://maps.google.com'},
            { pattern:  /^g\/m(us(ic)?)?$/i,
              link:     (val) => 'https://music.google.com'},
            { pattern:  /^g\/p(ho(to(s)?)?)?$/i,
              link:     (val) => 'https://photos.google.com'},
            { pattern:  /^g\/t(ra(nslate)?)?$/i,
              link:     (val) => 'https://translate.google.com'},
            { pattern:  /^g\/.+/i,
              link:     (val) => 'https://google.com/search?q=' + val.substring(2)},
            { pattern:  /^g(\/)?$/i,
              link:     (val) => 'https://google.com'},
            { pattern:  /^\/.+/i,
              link:     (val) => 'https://google.com/search?q=' + val.substring(1)},
            { pattern:  /^\/$/i,
              link:     (val) => 'https://google.com'},
            { pattern:  /^.+/i,
              link:     (val) => 'https://google.com/search?q=' + val}
        ];

        // Search on enter key event
        function search(e) {
            if (e.keyCode == 13) {
                var val = document.getElementById("search-field").value.trim();
                for (var i in searchPatterns) {
                    if (searchPatterns[i].pattern.test(val)) {
                        window.open(searchPatterns[i].link(val));
                        closeSearch();
                        break;
                    }
                }
            }
        }

        function openSearch() {
            document.getElementById('search').style.display = 'flex';
            document.getElementById('search-field').focus();
        }

        function closeSearch() {
            document.getElementById('search-field').value = '';
            document.getElementById('search-field').blur();
            document.getElementById('search').style.display = 'none';
        }

        document.addEventListener("keydown", event => {
            let code = event.keyCode;
            if (triggers.includes(code)) {
                openSearch();
            } else if (code == 27) {                        // Esc to close search
                closeSearch();
            }
        });

        var light;

        try {
            light = JSON.parse(localStorage.getItem("light"));
            if (light == null) {light = false;}
        } catch (err) {
            light = false;
        }

        function lightTheme() {
            document.body.classList.remove("dark-theme");
            document.body.classList.add("light-theme");
        }
        function darkTheme() {
            document.body.classList.remove("light-theme");
            document.body.classList.add("dark-theme");
        }
        function toggleTheme() {
            light = !light;
            refreshTheme();
        }
        function refreshTheme() {
            theme = light? lightTheme : darkTheme;
            theme();
            try {
                localStorage.setItem("light", JSON.stringify(light));
            } catch (err) {}
        }

        refreshTheme();
    </script>
</body>
</html>
